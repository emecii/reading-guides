<!DOCTYPE html>
<html lang="{{ meta.language }}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chapter {{ chapter.num }} Â· {{ chapter.title }} â€” {{ meta.title }}</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400&family=JetBrains+Mono:wght@400;500;600&family=Source+Serif+4:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../../../css/shared.css">
  <link rel="stylesheet" href="../css/chapter.css">
  <style>
    .concept-chips { display: flex; flex-wrap: wrap; gap: 10px; margin: 24px 0; }
    .quotes-list { display: flex; flex-direction: column; gap: 24px; margin: 32px 0; }
    .page-ref-callout { background: rgba(200,170,110,0.08); border-left: 3px solid var(--accent, #c8aa6e); border-radius: 0 8px 8px 0; padding: 20px 24px; margin: 32px 0; font-size: 15px; color: var(--muted, #8a8a8a); line-height: 1.6; }
    .page-ref-callout strong { color: var(--text, #e8e0d0); }
    .page-ref-callout .page-ref-icon { font-size: 20px; margin-right: 8px; }
    .image-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 24px; margin: 32px 0; }
    .chapter-image { background: rgba(255,255,255,0.03); border: 1px solid var(--border, #2a2a2a); border-radius: 12px; overflow: hidden; }
    .chapter-image img { width: 100%; height: auto; display: block; }
    .image-caption { padding: 12px 16px; font-size: 13px; color: var(--muted, #8a8a8a); line-height: 1.5; }
  </style>
</head>
<body>

  <!-- CHAPTER HERO -->
  <section class="chapter-hero">
    <div class="chapter-hero-inner">
      <div class="book-label">{{ chapter.book_label }}</div>
      <div class="chapter-number">Chapter <span>{{ chapter.num }}</span></div>
      <h1 class="chapter-title">{{ chapter.title }}</h1>
      <p class="chapter-subtitle">{{ chapter.subtitle }}</p>
      <div class="reading-meta">
        <span>{{ chapter.word_count }}</span>
        <span>{{ chapter.reading_time }} read</span>
      </div>
    </div>
  </section>

  <!-- PAGE BODY -->
  <main class="chapter-page">

    <!-- Breadcrumb -->
    <nav class="breadcrumb">
      <a href="../index.html">Home</a>
      <span class="separator">&gt;</span>
      <a href="../index.html">Book Map</a>
      <span class="separator">&gt;</span>
      <a href="../index.html">{{ chapter.book_label.split(' Â· ')[0] if ' Â· ' in chapter.book_label else chapter.book_label }}</a>
      <span class="separator">&gt;</span>
      Chapter {{ chapter.num }}
    </nav>

    {% if chapter.epigraph %}
    <!-- EPIGRAPH -->
    <blockquote class="epigraph">
      <p class="epigraph-text">{{ chapter.epigraph.text }}</p>
      <footer class="epigraph-attribution">{{ chapter.epigraph.attribution }}</footer>
    </blockquote>
    {% endif %}

    <!-- ARGUMENT FLOW -->
    {% if chapter.argument_flow %}
    <div class="chapter-section-title">
      <span class="section-overline">Argument Flow</span>
      <h2 class="section-heading">How the Chapter Builds Its Case</h2>
    </div>

    <div class="argument-flow">
      {% for step in chapter.argument_flow %}
      <div class="argument-step">
        <div class="step-number">{{ loop.index }}</div>
        <div class="step-content">
          <div class="step-heading">{{ step.heading }}</div>
          <div class="step-body">{{ step.body }}</div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %}

    <!-- PAGE REFERENCE -->
    {% if chapter.page_range %}
    <div class="page-ref-callout">
      <span class="page-ref-icon">ðŸ“–</span>
      <strong>Read {{ chapter.page_range }}</strong> in the book for the full chapter content. The analysis below covers the key arguments, examples, and takeaways.
    </div>
    {% endif %}

    <!-- CHAPTER IMAGES -->
    {% if chapter.images %}
    <div class="chapter-section-title">
      <span class="section-overline">Figures & Diagrams</span>
      <h2 class="section-heading">Visual Content from the Chapter</h2>
    </div>

    <div class="image-grid">
      {% for img in chapter.images %}
      <div class="chapter-image">
        <img src="../images/{{ img.filename }}" alt="{{ img.caption }}" loading="lazy">
        {% if img.caption %}
        <div class="image-caption">{{ img.caption }}</div>
        {% endif %}
      </div>
      {% endfor %}
    </div>
    {% endif %}

    <!-- EXAMPLES -->
    {% if chapter.examples %}
    <div class="chapter-section-title">
      <span class="section-overline">Key Examples</span>
      <h2 class="section-heading">Illustrative Cases</h2>
    </div>

    <div class="example-grid">
      {% for ex in chapter.examples %}
      <div class="example-card">
        <div class="example-icon">{{ ex.icon }}</div>
        <div class="example-title">{{ ex.title }}</div>
        <div class="example-desc">{{ ex.desc }}</div>
        <div class="example-lesson">{{ ex.lesson }}</div>
      </div>
      {% endfor %}
    </div>
    {% endif %}

    <!-- QUOTES -->
    {% if chapter.quotes %}
    <div class="chapter-section-title">
      <span class="section-overline">Notable Quotes</span>
      <h2 class="section-heading">Key Passages</h2>
    </div>

    <div class="quotes-list">
      {% for q in chapter.quotes %}
      <div class="taleb-quote">
        <p class="quote-text">{{ q.text }}</p>
        <p class="quote-context">{{ q.context }}</p>
      </div>
      {% endfor %}
    </div>
    {% endif %}

    <!-- CONCEPT LINKS -->
    {% if chapter.concept_links %}
    <div class="chapter-section-title">
      <span class="section-overline">Chapter Concepts</span>
      <h2 class="section-heading">Key Terms</h2>
    </div>

    <div class="concept-chips">
      {% for cid in chapter.concept_links %}
      <a class="concept-callout" href="../index.html#concepts">{{ cid }}</a>
      {% endfor %}
    </div>
    {% endif %}

    <!-- REFLECTIONS -->
    {% if chapter.reflections %}
    <div class="chapter-section-title">
      <span class="section-overline">Think & Discuss</span>
      <h2 class="section-heading">Reflection Prompts</h2>
    </div>

    <div class="reflection-grid">
      {% for r in chapter.reflections %}
      <div class="reflection-prompt">
        <div class="reflection-number">{{ '%02d' | format(loop.index) }}</div>
        <p class="reflection-text">{{ r }}</p>
      </div>
      {% endfor %}
    </div>
    {% endif %}

    <!-- CHAPTER NAVIGATION -->
    <footer class="chapter-nav-footer">
      {% if chapter.prev_chapter %}
      <a href="ch{{ '%02d' | format(chapter.prev_chapter.num) }}.html" class="chapter-nav-prev">
        <span class="nav-direction">Previous</span>
        <span class="nav-chapter-title">Chapter {{ chapter.prev_chapter.num }} Â· {{ chapter.prev_chapter.title }}</span>
      </a>
      {% else %}
      <div class="chapter-nav-prev" style="visibility: hidden;">
        <span class="nav-direction">Previous</span>
        <span class="nav-chapter-title"></span>
      </div>
      {% endif %}

      <div class="chapter-nav-center">
        <a href="../index.html">Back to Guide</a>
      </div>

      {% if chapter.next_chapter %}
      <a href="ch{{ '%02d' | format(chapter.next_chapter.num) }}.html" class="chapter-nav-next">
        <span class="nav-direction">Next</span>
        <span class="nav-chapter-title">Chapter {{ chapter.next_chapter.num }} Â· {{ chapter.next_chapter.title }}</span>
      </a>
      {% else %}
      <div class="chapter-nav-next" style="visibility: hidden;">
        <span class="nav-direction">Next</span>
        <span class="nav-chapter-title"></span>
      </div>
      {% endif %}
    </footer>

  </main>

  <script>
    document.querySelectorAll('.section-block-header').forEach(function(header) {
      header.addEventListener('click', function() {
        this.parentElement.classList.toggle('open');
      });
    });
  </script>

</body>
</html>
